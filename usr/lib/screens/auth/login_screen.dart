import 'package:flutter/material.dart';\nimport 'package:provider/provider.dart';\nimport '../../providers/auth_provider.dart';\nimport '../../providers/locale_provider.dart';\n\nclass LoginScreen extends StatefulWidget {\n  const LoginScreen({super.key});\n\n  @override\n  State<LoginScreen> createState() => _LoginScreenState();\n}\n\nclass _LoginScreenState extends State<LoginScreen> {\n  final _formKey = GlobalKey<FormState>();\n  final _emailController = TextEditingController();\n  final _passwordController = TextEditingController();\n  bool _isLoading = false;\n  bool _isSignup = false;\n\n  @override\n  void dispose() {\n    _emailController.dispose();\n    _passwordController.dispose();\n    super.dispose();\n  }\n\n  Future<void> _handleSubmit() async {\n    if (!_formKey.currentState!.validate()) return;\n\n    setState(() => _isLoading = true);\n\n    final authProvider = Provider.of<AuthProvider>(context, listen: false);\n    bool success;\n\n    if (_isSignup) {\n      success = await authProvider.signup(\n        _emailController.text,\n        _passwordController.text,\n      );\n    } else {\n      success = await authProvider.login(\n        _emailController.text,\n        _passwordController.text,\n      );\n    }\n\n    setState(() => _isLoading = false);\n\n    if (success && mounted) {\n      Navigator.of(context).pushReplacementNamed('/home');\n    } else if (mounted) {\n      ScaffoldMessenger.of(context).showSnackBar(\n        SnackBar(\n          content: Text(\n            _isSignup\n                ? 'Signup failed. Please try again.'\n                : 'Login failed. Please check your credentials.',\n          ),\n          backgroundColor: Colors.red,\n        ),\n      );\n    }\n  }\n\n  Future<void> _handleGoogleLogin() async {\n    setState(() => _isLoading = true);\n    final authProvider = Provider.of<AuthProvider>(context, listen: false);\n    final success = await authProvider.loginWithGoogle();\n    setState(() => _isLoading = false);\n\n    if (success && mounted) {\n      Navigator.of(context).pushReplacementNamed('/home');\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    final theme = Theme.of(context);\n\n    return Scaffold(\n      body: Container(\n        decoration: BoxDecoration(\n          gradient: LinearGradient(\n            begin: Alignment.topLeft,\n            end: Alignment.bottomRight,\n            colors: [\n              theme.colorScheme.primary.withOpacity(0.8),\n              theme.colorScheme.secondary.withOpacity(0.6),\n            ],\n          ),\n        ),\n        child: SafeArea(\n          child: Center(\n            child: SingleChildScrollView(\n              padding: const EdgeInsets.all(24.0),\n              child: Column(\n                mainAxisAlignment: MainAxisAlignment.center,\n                children: [\n                  // Language selector\n                  Align(\n                    alignment: Alignment.topRight,\n                    child: _buildLanguageSelector(context),\n                  ),\n                  const SizedBox(height: 40),\n                  // Logo/Title\n                  const Icon(\n                    Icons.music_note_rounded,\n                    size: 80,\n                    color: Colors.white,\n                  ),\n                  const SizedBox(height: 16),\n                  Text(\n                    'Artist Pro',\n                    style: theme.textTheme.headlineLarge?.copyWith(\n                      color: Colors.white,\n                      fontWeight: FontWeight.bold,\n                    ),\n                  ),\n                  const SizedBox(height: 8),\n                  Text(\n                    _isSignup ? 'Get Started' : 'Welcome Back!',\n                    style: theme.textTheme.titleMedium?.copyWith(\n                      color: Colors.white.withOpacity(0.9),\n                    ),\n                  ),\n                  const SizedBox(height: 48),\n                  // Form card\n                  Container(\n                    constraints: const BoxConstraints(maxWidth: 400),\n                    decoration: BoxDecoration(\n                      color: theme.cardColor.withOpacity(0.9),\n                      borderRadius: BorderRadius.circular(24),\n                      boxShadow: [\n                        BoxShadow(\n                          color: Colors.black.withOpacity(0.2),\n                          blurRadius: 20,\n                          offset: const Offset(0, 10),\n                        ),\n                      ],\n                    ),\n                    padding: const EdgeInsets.all(32),\n                    child: Form(\n                      key: _formKey,\n                      child: Column(\n                        children: [\n                          TextFormField(\n                            controller: _emailController,\n                            decoration: InputDecoration(\n                              labelText: 'Email',\n                              prefixIcon: const Icon(Icons.email_outlined),\n                              border: OutlineInputBorder(\n                                borderRadius: BorderRadius.circular(12),\n                              ),\n                            ),\n                            keyboardType: TextInputType.emailAddress,\n                            validator: (value) {\n                              if (value == null || value.isEmpty) {\n                                return 'Please enter your email';\n                              }\n                              if (!value.contains('@')) {\n                                return 'Please enter a valid email';\n                              }\n                              return null;\n                            },\n                          ),\n                          const SizedBox(height: 16),\n                          TextFormField(\n                            controller: _passwordController,\n                            decoration: InputDecoration(\n                              labelText: 'Password',\n                              prefixIcon: const Icon(Icons.lock_outline),\n                              border: OutlineInputBorder(\n                                borderRadius: BorderRadius.circular(12),\n                              ),\n                            ),\n                            obscureText: true,\n                            validator: (value) {\n                              if (value == null || value.isEmpty) {\n                                return 'Please enter your password';\n                              }\n                              if (value.length < 6) {\n                                return 'Password must be at least 6 characters';\n                              }\n                              return null;\n                            },\n                          ),\n                          if (!_isSignup)\n                            Column(\n                              children: [\n                                const SizedBox(height: 8),\n                                Align(\n                                  alignment: Alignment.centerRight,\n                                  child: TextButton(\n                                    onPressed: () {\n                                      // TODO: Implement forgot password\n                                    },\n                                    child: const Text('Forgot Password?'),\n                                  ),\n                                ),\n                              ],\n                            ),\n                          const SizedBox(height: 24),\n                          SizedBox(\n                            width: double.infinity,\n                            height: 48,\n                            child: ElevatedButton(\n                              onPressed: _isLoading ? null : _handleSubmit,\n                              style: ElevatedButton.styleFrom(\n                                backgroundColor: theme.colorScheme.primary,\n                                foregroundColor: Colors.white,\n                                shape: RoundedRectangleBorder(\n                                  borderRadius: BorderRadius.circular(12),\n                                ),\n                              ),\n                              child: _isLoading\n                                  ? const SizedBox(\n                                      height: 20,\n                                      width: 20,\n                                      child: CircularProgressIndicator(\n                                        strokeWidth: 2,\n                                        color: Colors.white,\n                                      ),\n                                    )\n                                  : Text(\n                                      _isSignup ? 'Sign Up' : 'Login',\n                                      style: const TextStyle(\n                                        fontSize: 16,\n                                        fontWeight: FontWeight.bold,\n                                      ),\n                                    ),\n                            ),\n                          ),\n                          const SizedBox(height: 16),\n                          Row(\n                            children: [\n                              const Expanded(child: Divider()),\n                              Padding(\n                                padding:\n                                    const EdgeInsets.symmetric(horizontal: 16),\n                                child: Text(\n                                  'OR',\n                                  style: theme.textTheme.bodySmall,\n                                ),\n                              ),\n                              const Expanded(child: Divider()),\n                            ],\n                          ),\n                          const SizedBox(height: 16),\n                          SizedBox(\n                            width: double.infinity,\n                            height: 48,\n                            child: OutlinedButton.icon(\n                              onPressed: _isLoading ? null : _handleGoogleLogin,\n                              icon: const Icon(Icons.g_mobiledata, size: 28),\n                              label: const Text('Login with Google'),\n                              style: OutlinedButton.styleFrom(\n                                shape: RoundedRectangleBorder(\n                                  borderRadius: BorderRadius.circular(12),\n                                ),\n                              ),\n                            ),\n                          ),\n                          const SizedBox(height: 16),\n                          TextButton(\n                            onPressed: () {\n                              setState(() => _isSignup = !_isSignup);\n                            },\n                            child: Text(\n                              _isSignup\n                                  ? 'Already have an account? Login'\n                                  : 'Create Account',\n                            ),\n                          ),\n                        ],\n                      ),\n                    ),\n                  ),\n                ],\n              ),\n            ),\n          ),\n        ),\n      ),\n    );\n  }\n\n  Widget _buildLanguageSelector(BuildContext context) {\n    final localeProvider = Provider.of<LocaleProvider>(context);\n    return Container(\n      padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),\n      decoration: BoxDecoration(\n        color: Colors.white.withOpacity(0.2),\n        borderRadius: BorderRadius.circular(20),\n      ),\n      child: DropdownButton<Locale>(\n        value: localeProvider.locale,\n        dropdownColor: Theme.of(context).cardColor,\n        underline: Container(),\n        icon: const Icon(Icons.language, color: Colors.white),\n        style: const TextStyle(color: Colors.white),\n        items: LocaleProvider.supportedLocales.map((locale) {\n          return DropdownMenuItem(\n            value: locale,\n            child: Text(\n              LocaleProvider.languageNames[locale.languageCode] ?? '',\n              style: TextStyle(\n                color: Theme.of(context).brightness == Brightness.dark\n                    ? Colors.white\n                    : Colors.black,\n              ),\n            ),\n          );\n        }).toList(),\n        onChanged: (locale) {\n          if (locale != null) {\n            localeProvider.setLocale(locale);\n          }\n        },\n      ),\n    );\n  }\n}\n