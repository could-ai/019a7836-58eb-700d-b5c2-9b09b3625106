import 'package:flutter/material.dart';\nimport 'package:provider/provider.dart';\nimport '../providers/auth_provider.dart';\nimport '../providers/theme_provider.dart';\nimport '../providers/locale_provider.dart';\nimport 'dashboard/dashboard_screen.dart';\nimport 'setlists/setlists_screen.dart';\nimport 'songs/songs_screen.dart';\nimport 'schedule/schedule_screen.dart';\nimport 'compositions/compositions_screen.dart';\nimport 'checklist/checklist_screen.dart';\nimport 'financial/financial_screen.dart';\nimport 'settings/settings_screen.dart';\n\nclass MainLayout extends StatefulWidget {\n  const MainLayout({super.key});\n\n  @override\n  State<MainLayout> createState() => _MainLayoutState();\n}\n\nclass _MainLayoutState extends State<MainLayout> {\n  int _selectedIndex = 0;\n  bool _isDrawerExpanded = true;\n\n  final List<_NavigationItem> _navItems = [\n    _NavigationItem(\n      icon: Icons.dashboard_rounded,\n      label: 'Dashboard',\n      labelKey: 'dashboard',\n    ),\n    _NavigationItem(\n      icon: Icons.queue_music_rounded,\n      label: 'Setlists',\n      labelKey: 'setlists',\n    ),\n    _NavigationItem(\n      icon: Icons.library_music_rounded,\n      label: 'Song Library',\n      labelKey: 'songLibrary',\n    ),\n    _NavigationItem(\n      icon: Icons.calendar_month_rounded,\n      label: 'Schedule',\n      labelKey: 'schedule',\n    ),\n    _NavigationItem(\n      icon: Icons.edit_note_rounded,\n      label: 'Compositions',\n      labelKey: 'compositions',\n    ),\n    _NavigationItem(\n      icon: Icons.checklist_rounded,\n      label: 'Checklist',\n      labelKey: 'checklist',\n    ),\n    _NavigationItem(\n      icon: Icons.attach_money_rounded,\n      label: 'Financial Report',\n      labelKey: 'financialReport',\n    ),\n    _NavigationItem(\n      icon: Icons.settings_rounded,\n      label: 'Settings',\n      labelKey: 'settings',\n    ),\n  ];\n\n  final List<Widget> _screens = [\n    const DashboardScreen(),\n    const SetlistsScreen(),\n    const SongsScreen(),\n    const ScheduleScreen(),\n    const CompositionsScreen(),\n    const ChecklistScreen(),\n    const FinancialScreen(),\n    const SettingsScreen(),\n  ];\n\n  @override\n  Widget build(BuildContext context) {\n    final theme = Theme.of(context);\n    final authProvider = Provider.of<AuthProvider>(context);\n    final themeProvider = Provider.of<ThemeProvider>(context);\n    final localeProvider = Provider.of<LocaleProvider>(context);\n    final isMobile = MediaQuery.of(context).size.width < 768;\n\n    if (isMobile) {\n      _isDrawerExpanded = false;\n    }\n\n    return Scaffold(\n      body: Row(\n        children: [\n          // Side Navigation\n          if (!isMobile)\n            AnimatedContainer(\n              duration: const Duration(milliseconds: 300),\n              width: _isDrawerExpanded ? 280 : 80,\n              decoration: BoxDecoration(\n                color: theme.colorScheme.surface,\n                border: Border(\n                  right: BorderSide(\n                    color: theme.dividerColor.withOpacity(0.1),\n                    width: 1,\n                  ),\n                ),\n              ),\n              child: Column(\n                children: [\n                  // Logo/Header\n                  Container(\n                    height: 80,\n                    padding: const EdgeInsets.symmetric(horizontal: 16),\n                    child: Row(\n                      children: [\n                        Icon(\n                          Icons.music_note_rounded,\n                          size: 32,\n                          color: theme.colorScheme.primary,\n                        ),\n                        if (_isDrawerExpanded) ..[\n                          const SizedBox(width: 12),\n                          Expanded(\n                            child: Text(\n                              'Artist Pro',\n                              style: theme.textTheme.titleLarge?.copyWith(\n                                fontWeight: FontWeight.bold,\n                              ),\n                            ),\n                          ),\n                        ],\n                        IconButton(\n                          icon: Icon(\n                            _isDrawerExpanded\n                                ? Icons.menu_open_rounded\n                                : Icons.menu_rounded,\n                          ),\n                          onPressed: () {\n                            setState(() {\n                              _isDrawerExpanded = !_isDrawerExpanded;\n                            });\n                          },\n                        ),\n                      ],\n                    ),\n                  ),\n                  const Divider(height: 1),\n                  // Navigation Items\n                  Expanded(\n                    child: ListView.builder(\n                      padding: const EdgeInsets.symmetric(vertical: 8),\n                      itemCount: _navItems.length,\n                      itemBuilder: (context, index) {\n                        final item = _navItems[index];\n                        final isSelected = _selectedIndex == index;\n                        return _buildNavItem(\n                          context,\n                          item,\n                          isSelected,\n                          () {\n                            setState(() {\n                              _selectedIndex = index;\n                            });\n                          },\n                        );\n                      },\n                    ),\n                  ),\n                  // User Profile\n                  const Divider(height: 1),\n                  _buildUserProfile(context, authProvider),\n                ],\n              ),\n            ),\n          // Main Content Area\n          Expanded(\n            child: Column(\n              children: [\n                // Header\n                Container(\n                  height: 80,\n                  padding: const EdgeInsets.symmetric(horizontal: 24),\n                  decoration: BoxDecoration(\n                    color: theme.colorScheme.surface,\n                    border: Border(\n                      bottom: BorderSide(\n                        color: theme.dividerColor.withOpacity(0.1),\n                        width: 1,\n                      ),\n                    ),\n                  ),\n                  child: Row(\n                    children: [\n                      if (isMobile)\n                        IconButton(\n                          icon: const Icon(Icons.menu_rounded),\n                          onPressed: () {\n                            Scaffold.of(context).openDrawer();\n                          },\n                        ),\n                      Expanded(\n                        child: Text(\n                          _navItems[_selectedIndex].label,\n                          style: theme.textTheme.headlineSmall?.copyWith(\n                            fontWeight: FontWeight.bold,\n                          ),\n                        ),\n                      ),\n                      // Language Selector\n                      _buildLanguageSelector(context, localeProvider),\n                      const SizedBox(width: 16),\n                      // Theme Toggle\n                      IconButton(\n                        icon: Icon(\n                          themeProvider.isDarkMode\n                              ? Icons.light_mode_rounded\n                              : Icons.dark_mode_rounded,\n                        ),\n                        onPressed: () {\n                          themeProvider.toggleTheme();\n                        },\n                        tooltip: themeProvider.isDarkMode\n                            ? 'Light Mode'\n                            : 'Dark Mode',\n                      ),\n                    ],\n                  ),\n                ),\n                // Content\n                Expanded(\n                  child: _screens[_selectedIndex],\n                ),\n              ],\n            ),\n          ),\n        ],\n      ),\n      // Mobile Drawer\n      drawer: isMobile\n          ? Drawer(\n              child: Column(\n                children: [\n                  DrawerHeader(\n                    decoration: BoxDecoration(\n                      gradient: LinearGradient(\n                        begin: Alignment.topLeft,\n                        end: Alignment.bottomRight,\n                        colors: [\n                          theme.colorScheme.primary,\n                          theme.colorScheme.secondary,\n                        ],\n                      ),\n                    ),\n                    child: Column(\n                      crossAxisAlignment: CrossAxisAlignment.start,\n                      mainAxisAlignment: MainAxisAlignment.end,\n                      children: [\n                        const Icon(\n                          Icons.music_note_rounded,\n                          size: 48,\n                          color: Colors.white,\n                        ),\n                        const SizedBox(height: 8),\n                        Text(\n                          'Artist Pro',\n                          style: theme.textTheme.headlineSmall?.copyWith(\n                            color: Colors.white,\n                            fontWeight: FontWeight.bold,\n                          ),\n                        ),\n                      ],\n                    ),\n                  ),\n                  Expanded(\n                    child: ListView.builder(\n                      padding: EdgeInsets.zero,\n                      itemCount: _navItems.length,\n                      itemBuilder: (context, index) {\n                        final item = _navItems[index];\n                        final isSelected = _selectedIndex == index;\n                        return ListTile(\n                          leading: Icon(\n                            item.icon,\n                            color: isSelected\n                                ? theme.colorScheme.primary\n                                : theme.iconTheme.color,\n                          ),\n                          title: Text(\n                            item.label,\n                            style: TextStyle(\n                              color: isSelected\n                                  ? theme.colorScheme.primary\n                                  : null,\n                              fontWeight: isSelected\n                                  ? FontWeight.bold\n                                  : FontWeight.normal,\n                            ),\n                          ),\n                          selected: isSelected,\n                          onTap: () {\n                            setState(() {\n                              _selectedIndex = index;\n                            });\n                            Navigator.of(context).pop();\n                          },\n                        );\n                      },\n                    ),\n                  ),\n                  const Divider(height: 1),\n                  _buildUserProfile(context, authProvider),\n                ],\n              ),\n            )\n          : null,\n    );\n  }\n\n  Widget _buildNavItem(\n    BuildContext context,\n    _NavigationItem item,\n    bool isSelected,\n    VoidCallback onTap,\n  ) {\n    final theme = Theme.of(context);\n    return Container(\n      margin: const EdgeInsets.symmetric(horizontal: 8, vertical: 2),\n      child: Material(\n        color: isSelected\n            ? theme.colorScheme.primary.withOpacity(0.1)\n            : Colors.transparent,\n        borderRadius: BorderRadius.circular(12),\n        child: InkWell(\n          onTap: onTap,\n          borderRadius: BorderRadius.circular(12),\n          child: Container(\n            padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),\n            child: Row(\n              children: [\n                Icon(\n                  item.icon,\n                  color: isSelected\n                      ? theme.colorScheme.primary\n                      : theme.iconTheme.color,\n                ),\n                if (_isDrawerExpanded) ..[\n                  const SizedBox(width: 16),\n                  Expanded(\n                    child: Text(\n                      item.label,\n                      style: theme.textTheme.bodyLarge?.copyWith(\n                        color: isSelected ? theme.colorScheme.primary : null,\n                        fontWeight:\n                            isSelected ? FontWeight.bold : FontWeight.normal,\n                      ),\n                    ),\n                  ),\n                ],\n              ],\n            ),\n          ),\n        ),\n      ),\n    );\n  }\n\n  Widget _buildUserProfile(BuildContext context, AuthProvider authProvider) {\n    final theme = Theme.of(context);\n    final userName = authProvider.userName ?? 'User';\n    final userEmail = authProvider.userEmail ?? 'user@email.com';\n\n    return Container(\n      padding: const EdgeInsets.all(16),\n      child: Row(\n        children: [\n          CircleAvatar(\n            backgroundColor: theme.colorScheme.primary,\n            child: Text(\n              userName[0].toUpperCase(),\n              style: const TextStyle(\n                color: Colors.white,\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n          ),\n          if (_isDrawerExpanded) ..[\n            const SizedBox(width: 12),\n            Expanded(\n              child: Column(\n                crossAxisAlignment: CrossAxisAlignment.start,\n                mainAxisSize: MainAxisSize.min,\n                children: [\n                  Text(\n                    userName,\n                    style: theme.textTheme.bodyMedium?.copyWith(\n                      fontWeight: FontWeight.bold,\n                    ),\n                    overflow: TextOverflow.ellipsis,\n                  ),\n                  Text(\n                    userEmail,\n                    style: theme.textTheme.bodySmall?.copyWith(\n                      color: theme.textTheme.bodySmall?.color?.withOpacity(0.7),\n                    ),\n                    overflow: TextOverflow.ellipsis,\n                  ),\n                ],\n              ),\n            ),\n            IconButton(\n              icon: const Icon(Icons.logout_rounded),\n              onPressed: () async {\n                await authProvider.logout();\n                if (context.mounted) {\n                  Navigator.of(context).pushReplacementNamed('/login');\n                }\n              },\n              tooltip: 'Logout',\n            ),\n          ],\n        ],\n      ),\n    );\n  }\n\n  Widget _buildLanguageSelector(\n    BuildContext context,\n    LocaleProvider localeProvider,\n  ) {\n    final theme = Theme.of(context);\n    return PopupMenuButton<Locale>(\n      icon: const Icon(Icons.language_rounded),\n      tooltip: 'Language',\n      onSelected: (locale) {\n        localeProvider.setLocale(locale);\n      },\n      itemBuilder: (context) {\n        return LocaleProvider.supportedLocales.map((locale) {\n          return PopupMenuItem<Locale>(\n            value: locale,\n            child: Row(\n              children: [\n                if (localeProvider.locale == locale)\n                  Icon(\n                    Icons.check_rounded,\n                    color: theme.colorScheme.primary,\n                    size: 20,\n                  )\n                else\n                  const SizedBox(width: 20),\n                const SizedBox(width: 8),\n                Text(LocaleProvider.languageNames[locale.languageCode] ?? ''),\n              ],\n            ),\n          );\n        }).toList();\n      },\n    );\n  }\n}\n\nclass _NavigationItem {\n  final IconData icon;\n  final String label;\n  final String labelKey;\n\n  _NavigationItem({\n    required this.icon,\n    required this.label,\n    required this.labelKey,\n  });\n}\n